
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="404Forest">
    <title>使用 requestAnimationFrame 实现性能优化与懒执行 - 404Forest</title>
    <meta name="author" content="Jin">
    
        <link rel="icon" href="/assets/images/favicon.ico">
    
    
    <meta name="description" content="去年在《谈谈网页中的 Animation 》中曾经提到了 requestAnimationFrame 这个 API，非常适合用来做流畅的动画效果。其实除了做动画的优化，requestAnimationFrame 也可以做其他方面的性能优化。">
<meta property="og:type" content="blog">
<meta property="og:title" content="使用 requestAnimationFrame 实现性能优化与懒执行">
<meta property="og:url" content="http://www.404forest.com/2016/08/15/%E4%BD%BF%E7%94%A8%20requestAnimationFrame%20%E5%AE%9E%E7%8E%B0%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%8E%E6%87%92%E6%89%A7%E8%A1%8C/index.html">
<meta property="og:site_name" content="404Forest">
<meta property="og:description" content="去年在《谈谈网页中的 Animation 》中曾经提到了 requestAnimationFrame 这个 API，非常适合用来做流畅的动画效果。其实除了做动画的优化，requestAnimationFrame 也可以做其他方面的性能优化。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.404forest.com/imgs/blog/rAF-test1.png">
<meta property="og:image" content="http://www.404forest.com/imgs/blog/rAF-test2.png">
<meta property="article:published_time" content="2016-08-15T23:00:11.000Z">
<meta property="article:modified_time" content="2025-02-04T23:02:44.264Z">
<meta property="article:author" content="Jin">
<meta property="article:tag" content="requestAnimationFrame">
<meta property="article:tag" content="性能优化">
<meta property="article:tag" content="懒执行">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.404forest.com/imgs/blog/rAF-test1.png">
<meta name="twitter:creator" content="@jin5354">
    
    
    
        <meta property="og:image" content="/assets/images/ava.png"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style.min.css">

    <!--STYLES END-->
    
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-66492678-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

</head>

    <body>
        <div id="blog">
            <header id="header" data-behavior="3">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/%20">404Forest</a>
    </h1>
    
        <a class="header-right-picture" href="/#about">
            <img class="header-picture" src="/assets/images/ava.png"/>
        </a>
    
</header>
            <nav id="sidebar" data-behavior="3">
    
        <div class="sidebar-profile">
            <a href="/#about">
                
                    <img class="sidebar-profile-picture" src="/assets/images/ava.png"/>
                
            </a>
            <span class="sidebar-profile-name">Jin</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/%20"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Archive</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">Categories</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">Search</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://github.com/jin5354" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="mailto:xiaoyanjinx@gmail.com" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i>
                    <span class="sidebar-button-desc">Mail</span>
                </a>
        </li>
        
    </ul>
    
    <div style="margin-left: 27px;">
        <a target="_blank" rel="noopener" href="https://github.com/jin5354/404forest"><img src="https://img.shields.io/github/stars/jin5354/404forest.svg?style=social&label=Stars"></a>
    </div>
</nav>

            
            <div id="main" data-behavior="3"
                 class="
                        hasCoverMetaIn
                        ">
                <article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            使用 requestAnimationFrame 实现性能优化与懒执行
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" content="Mon Aug 15 2016 16:00:11 GMT-0700">
	
		    8月 15, 2016
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Code/">Code</a>


    
</div>
</div>
    
    <div class="main-content-wrap" style="margin-top: 60px;">索引</div>
    <ol class="main-content-wrap toc-article"><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-3"><a class="main-content-wrap toc-article-link" href="#JS-%E6%87%92%E6%89%A7%E8%A1%8C"><span class="main-content-wrap toc-article-text">JS 懒执行</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-3"><a class="main-content-wrap toc-article-link" href="#%E5%87%BD%E6%95%B0%E9%98%B2%E6%8A%96%EF%BC%88Debouncing%EF%BC%89%E4%B8%8E%E8%8A%82%E6%B5%81%EF%BC%88Throttling%EF%BC%89"><span class="main-content-wrap toc-article-text">函数防抖（Debouncing）与节流（Throttling）</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-3"><a class="main-content-wrap toc-article-link" href="#%E5%B0%86-JS-%E6%89%93%E7%A2%8E%EF%BC%8C%E5%88%86%E5%B8%A7%E6%93%8D%E4%BD%9C%EF%BC%8C%E9%81%BF%E5%85%8D%E9%98%BB%E5%A1%9E-UI"><span class="main-content-wrap toc-article-text">将 JS 打碎，分帧操作，避免阻塞 UI</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-3"><a class="main-content-wrap toc-article-link" href="#%E6%B5%8B%E8%AF%95"><span class="main-content-wrap toc-article-text">测试</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-3"><a class="main-content-wrap toc-article-link" href="#rAF-polyfill-%E9%99%84%E5%BD%95"><span class="main-content-wrap toc-article-text">rAF polyfill 附录</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-3"><a class="main-content-wrap toc-article-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="main-content-wrap toc-article-text">参考文章</span></a></li></ol>
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p>去年在<a href="/2015/08/24/谈谈网页中的Animation/">《谈谈网页中的 Animation 》</a>中曾经提到了 requestAnimationFrame 这个 API，非常适合用来做流畅的动画效果。其实除了做动画的优化，requestAnimationFrame 也可以做其他方面的性能优化。</p>
<a id="more"></a>
<h3 id="JS-懒执行"><a href="#JS-懒执行" class="headerlink" title="JS 懒执行"></a>JS 懒执行</h3><p>requestAnimationFrame 的执行时机是在页面重绘之前，我们知道浏览器中 JS 的执行是会阻塞页面渲染的，所以 requestAnimationFrame 的执行时机同样代表着当前 JS 线程的空闲。这样的话，在一些 JS 负荷较重的页面，我们可以通过对 JS 任务区分优先级，实现关键任务的优先加载，非关键业务的懒加载。</p>
<p>例如一个店铺首页页面，由多个JS模块构成：店铺信息、店长信息、商品详情、导航条……等等。为了缩短首屏可交互时间，优化体验，我们可以把首屏出现的3个模块定为“关键模块”，立刻加载并渲染；其他模块推送到懒加载序列，等待空闲时再运行。相比与所有模块一同加载并渲染，首屏模块先加载先展现，可以有效缩短首屏的等待时间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; componentList.length; i++) &#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(<span class="regexp">/601|602|701|702|703|801|802|803|/</span>.test(componentList[i].sectionId))&#123;</div><div class="line">            loadComponent(componentList[i].sectionId);</div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">window</span>.requestAnimationFrame(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;   <span class="comment">//直接这么写真的好么？请看下文</span></div><div class="line">                loadComponent(componentList[i].sectionId);</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">    VTrace.report(<span class="string">'error'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="函数防抖（Debouncing）与节流（Throttling）"><a href="#函数防抖（Debouncing）与节流（Throttling）" class="headerlink" title="函数防抖（Debouncing）与节流（Throttling）"></a>函数防抖（Debouncing）与节流（Throttling）</h3><p>这是一个比较常被提起的话题，有时我们会写出一些高频率事件（常见于 mouseover、resize 事件或者 scroll 事件）：</p>
<p>拿常见的 lazyload（图片懒加载）举个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">LazyLoad = &#123;</div><div class="line">    <span class="comment">// ... 省略掉无关的代码 ...</span></div><div class="line">    processScroll: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; LazyLoad.images.length; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (LazyLoad.elementInViewport(LazyLoad.images[i])) &#123;</div><div class="line">                (<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;</div><div class="line">                    LazyLoad.loadImage(LazyLoad.images[i]);</div><div class="line">                &#125;)(i)</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'scroll'</span>, LazyLoad.processScroll);</div></pre></td></tr></table></figure>
<p>上面是 lazyload 的一段必备逻辑：在滚动时，判断懒加载的图片有没有出现在视口中，如果出现了，那么真正加载图片。scroll 事件就是一个非常常见的高频率事件。当浏览器滚动时，一秒可以触发 scroll 事件几十上百次，若 scroll 绑定的事件内部处理较复杂，耗时较多，非常容易出现 CPU 占用率飙升，网页 FPS 突降的现象。</p>
<p>使用防抖（Debouncing）处理，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">LazyLoad = &#123;</div><div class="line">    <span class="comment">// ... 省略掉无关的代码 ...</span></div><div class="line">    timer: <span class="literal">null</span>,</div><div class="line">    <span class="attr">processScroll</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span>(LazyLoad.timer)&#123;</div><div class="line">            clearTimeout(LazyLoad.timer);</div><div class="line">            LazyLoad.timer = <span class="literal">null</span>;</div><div class="line">        &#125;</div><div class="line">        LazyLoad.timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; LazyLoad.images.length; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (LazyLoad.elementInViewport(LazyLoad.images[i])) &#123;</div><div class="line">                    (<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;</div><div class="line">                        LazyLoad.loadImage(LazyLoad.images[i]);</div><div class="line">                    &#125;)(i)</div><div class="line">                &#125;</div><div class="line">            &#125;;</div><div class="line">        &#125;,<span class="number">200</span>);</div><div class="line">    &#125;,</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'scroll'</span>, LazyLoad.processScroll);</div></pre></td></tr></table></figure>
<p>每次滚动后不是立即执行操作，而是使用 setTimeout 延时 200ms 后执行；如果连续多次触发 scroll 事件，后执行的操作会取消并重置计时器，也就是说连续滚动时不会执行操作，停手后的 0.2s 之后会执行操作。</p>
<p>这样做可以将多次的、连续的调用合并为一次。有效的防止了频繁触发事件带来的性能问题。缺点时：当用户一直滚动不放时，函数就一直不执行，用户就一直看不到图片。最佳做法是：高频率调用函数时，不能执行太频繁，但也不能一直不执行，至少要每 X 毫秒执行一次。这就是节流（Throttling）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">LazyLoad = &#123;</div><div class="line">    <span class="comment">// ... 省略掉无关的代码 ...</span></div><div class="line">    timer: <span class="literal">null</span>,</div><div class="line">    <span class="attr">baseTimeStamp</span>: <span class="literal">null</span>,</div><div class="line">    <span class="attr">processScroll</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> now = <span class="built_in">Date</span>.now();</div><div class="line">        <span class="keyword">if</span>(!LazyLoad.baseTimeStamp) LazyLoad.baseTimeStamp = now;</div><div class="line">        <span class="keyword">if</span>(now - LazyLoad.baseTimeStamp &gt; <span class="number">200</span>) &#123;</div><div class="line">            LazyLoad.loadImages();</div><div class="line">            LazyLoad.baseTimeStamp = now;</div><div class="line">            clearTimeout(LazyLoad.timer);</div><div class="line">            LazyLoad.timer = <span class="literal">null</span>;</div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            clearTimeout(LazyLoad.timer);</div><div class="line">            LazyLoad.timer = <span class="literal">null</span>;</div><div class="line">            LazyLoad.timer = setTimeout(LazyLoad.loadImages, <span class="number">200</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">//抽出操作函数来复用..</span></div><div class="line">    loadImages: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; LazyLoad.images.length; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (LazyLoad.elementInViewport(LazyLoad.images[i])) &#123;</div><div class="line">                (<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;</div><div class="line">                    LazyLoad.loadImage(LazyLoad.images[i]);</div><div class="line">                &#125;)(i)</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'scroll'</span>, LazyLoad.processScroll);</div></pre></td></tr></table></figure>
<p>上面代码就实现了节流（Throttling），即使用户一直滚动不放手，也会每 200ms 执行一次，完美实现高频率事件的性能优化。</p>
<p>这个 200ms 是由我们掌控的，一般会设置一个保守一点的数字。如果想榨干浏览器性能，可以使用 requestAnimationFrame 来做节流，让浏览器自动在空闲时执行操作，可以在性能优化的前提下，尽量多执行操作，增强用户体验。（0.2秒毕竟也要顿一下…）</p>
<p>requestAnimationFrame 只会将操作延迟到下次重绘前执行，并不会主动做节流；所以网上某些参考资料的实例代码是错误的，如：<a href="http://www.ghugo.com/requestanimationframe-best-practice/" target="_blank" rel="external">http://www.ghugo.com/requestanimationframe-best-practice/</a>中所说的：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> $box = $(<span class="string">'#J_num2'</span>),</div><div class="line">    $point = $box.find(<span class="string">'i'</span>);</div><div class="line"></div><div class="line">$box.on(<span class="string">'mousemove'</span>,<span class="function"><span class="keyword">function</span><span class="params">(e)</span></span>&#123;</div><div class="line">  requestAnimationFrame(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</div><div class="line">    $point.css(&#123;</div><div class="line">      top : e.pageY,</div><div class="line">      left : e.pageX</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>仔细一看，mousemove 事件每秒被触发的次数依旧是数十次，这只是把这几十次的操作延迟到下一帧操作之前执行而已，使用 rAF 只能算做了个延时，并没有减少函数执行次数。真正做到节流，需要引入一个“锁”来控制。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> $box = $(<span class="string">'#J_num2'</span>),</div><div class="line">    $point = $box.find(<span class="string">'i'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> locked = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">$box.on(<span class="string">'mousemove'</span>,<span class="function"><span class="keyword">function</span><span class="params">(e)</span></span>&#123;</div><div class="line">  <span class="keyword">if</span>(!locked)&#123;</div><div class="line">    requestAnimationFrame(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</div><div class="line">      changeCSS(e);</div><div class="line">    &#125;);</div><div class="line">    locked = <span class="keyword">true</span>;</div><div class="line">  &#125;<span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeCSS</span><span class="params">(e)</span> </span>&#123;</div><div class="line">  $point.css(&#123;</div><div class="line">    top : e.pageY,</div><div class="line">    left : e.pageX</div><div class="line">  &#125;)</div><div class="line">  locked = <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>引入一个 locked 变量表示当前能否响应操作；如果能，执行 rAF 后锁住，此时不再响应新请求；在 rAF 注册的函数执行完毕后解锁。这样即可保证一帧内只用 rAF 注册一次函数。</p>
<h3 id="将-JS-打碎，分帧操作，避免阻塞-UI"><a href="#将-JS-打碎，分帧操作，避免阻塞-UI" class="headerlink" title="将 JS 打碎，分帧操作，避免阻塞 UI"></a>将 JS 打碎，分帧操作，避免阻塞 UI</h3><p><a href="http://www.ghugo.com/requestanimationframe-best-practice/" target="_blank" rel="external">http://www.ghugo.com/requestanimationframe-best-practice/</a>中的用法4提到了这一点，然而示例代码也有同样的问题：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//页面中有4个模块，A、B、C、D，在页面加载时进行实例化，一般的写法类似于：</span></div><div class="line"></div><div class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">new</span> A();</div><div class="line">    <span class="keyword">new</span> B();</div><div class="line">    <span class="keyword">new</span> C();</div><div class="line">    <span class="keyword">new</span> D();</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//使用raf可将每个模块分别初始化，即每个模块都有16ms的初始化时间</span></div><div class="line"></div><div class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> lazyLoadList = [A,B,C,D];</div><div class="line">    $.each(lazyloadList, <span class="function"><span class="keyword">function</span>(<span class="params">index, module</span>)</span>&#123;</div><div class="line">        <span class="built_in">window</span>.requestAnimationFrame(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">new</span> <span class="built_in">module</span>()&#125;);  <span class="comment">//不太对</span></div><div class="line">    &#125;);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>同理，直接在循环里面使用 rAF 只是瞬间注册了多个操作，这些操作会全部累积起来到下一帧重绘前执行，实际上阻塞了下一帧。这种写法与不使用 rAF 的写法相比，只增加了一帧。要真的做到分帧操作，要这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> lazyLoadList = [A,B,C,D];</div><div class="line"></div><div class="line">    <span class="keyword">var</span> load = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> <span class="built_in">module</span> = lazyLoadList.shift();</div><div class="line">      <span class="keyword">if</span>(<span class="built_in">module</span>) &#123;</div><div class="line">        <span class="keyword">new</span> <span class="built_in">module</span>();</div><div class="line">        <span class="built_in">window</span>.requestAnimationFrame(load); <span class="comment">//写个递归</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">window</span>.requestAnimationFrame(load);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>在第一节中提出的问题也就很好回答了：既然都打算使用懒执行了，直接加入递归实现分帧操作是最好的选择。</p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>构建一个测试，看一看效果如何：</p>
<p>首先在页面上用 rAF 不停的跑一个修改UI的操作，触发 chrome timeline 面板对 frame 的持续记录。假设我们有个 JS 操作密集的页面，比如要串行加载许多模块：</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">function <span class="class"><span class="keyword">module</span>(<span class="title">time</span>) &#123;   //构建耗时函数</span></div><div class="line">    var startTime = Date.now();</div><div class="line">    <span class="keyword">while</span>(Date.now() - startTime &lt; time)&#123;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">module</span>(20);</span></div><div class="line"><span class="class"><span class="keyword">module</span>(15);</span></div><div class="line"><span class="class"><span class="keyword">module</span>(10);</span></div><div class="line"><span class="class"><span class="keyword">module</span>(10);</span></div><div class="line"><span class="class"><span class="keyword">module</span>(16);</span></div><div class="line"><span class="class"><span class="keyword">module</span>(5);</span></div><div class="line"><span class="class"><span class="keyword">module</span>(15);</span></div><div class="line"><span class="class"><span class="keyword">module</span>(18);</span></div><div class="line"><span class="class"><span class="keyword">module</span>(7);</span></div><div class="line"><span class="class"><span class="keyword">module</span>(30);</span></div><div class="line"><span class="class"><span class="keyword">module</span>(13);</span></div><div class="line"><span class="class"><span class="keyword">module</span>(10);</span></div><div class="line"><span class="class"><span class="keyword">module</span>(2);</span></div><div class="line"><span class="class"><span class="keyword">module</span>(9);</span></div></pre></td></tr></table></figure>
<p>执行效果如下：</p>
<p><img src="/imgs/blog/rAF-test1.png" alt="rAF-test1"></p>
<p>执行时狠狠的阻塞了一下，fps陡降至6，页面明显停顿一下。</p>
<p>试用一下 rAF 分帧执行：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> lazyLoadList = [</div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">module</span>(<span class="number">20</span>);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">module</span>(<span class="number">15</span>);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">module</span>(<span class="number">10</span>);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">module</span>(<span class="number">10</span>);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">module</span>(<span class="number">16</span>);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">module</span>(<span class="number">5</span>);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">module</span>(<span class="number">15</span>);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">module</span>(<span class="number">18</span>);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">module</span>(<span class="number">7</span>);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">module</span>(<span class="number">30</span>);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">module</span>(<span class="number">13</span>);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">module</span>(<span class="number">10</span>);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">module</span>(<span class="number">2</span>);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">module</span>(<span class="number">9</span>);</div><div class="line">    &#125;</div><div class="line">];</div><div class="line"></div><div class="line"><span class="keyword">var</span> load = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> <span class="built_in">module</span> = lazyLoadList.shift();</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">module</span>) &#123;</div><div class="line">        <span class="built_in">module</span>();</div><div class="line">        <span class="built_in">window</span>.requestAnimationFrame(load); <span class="comment">//写个递归</span></div><div class="line">    &#125;<span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="built_in">window</span>.requestAnimationFrame(load);</div></pre></td></tr></table></figure>
<p>跑跑看结果：</p>
<p><img src="/imgs/blog/rAF-test2.png" alt="rAF-test2"></p>
<p>虽然帧率也会下降，但是最低也能保证 20fps 以上(受限于那几个执行时间为20ms以上的模块)，页面不会赶到明显的顿卡，使用 rAF 可以比较有效的将阻塞“稀释”掉。进一步的优化则是要针对执行时间达到 20ms 以上的模块，尝试打碎逻辑；使每个模块的执行时间保证在 16.7ms 以内是最佳的。</p>
<blockquote>
<p>requestAnimationFrame最主要的意义，是降帧而非升帧，以防止丢帧。它的目的更类似于垂直同步，而非越快越好。<br>MSDN: 帧率不等或跳帧会使人感觉你的站点速度缓慢。如果降低动画速度可以减少跳帧并有助于保持帧率一致，它可以使人感觉站点速度更快。<br>阅读更多：<a href="http://creativejs.com/resources/requestanimationframe/" target="_blank" rel="external">http://creativejs.com/resources/requestanimationframe/</a></p>
</blockquote>
<h3 id="rAF-polyfill-附录"><a href="#rAF-polyfill-附录" class="headerlink" title="rAF polyfill 附录"></a>rAF polyfill 附录</h3><p>rAF 在部分浏览器上还是需要使用polyfill，下面记录一个被广泛使用的版本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// https://gist.github.com/miksago/3035015</span></div><div class="line"><span class="comment">// http://paulirish.com/2011/requestanimationframe-for-smart-animating/</span></div><div class="line"><span class="comment">// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating</span></div><div class="line"></div><div class="line"><span class="comment">// requestAnimationFrame polyfill by Erik Möller</span></div><div class="line"><span class="comment">// fixes from Paul Irish and Tino Zijdel</span></div><div class="line"></div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> lastTime = <span class="number">0</span>;</div><div class="line">  <span class="keyword">var</span> vendors = [<span class="string">'ms'</span>, <span class="string">'moz'</span>, <span class="string">'webkit'</span>, <span class="string">'o'</span>];</div><div class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> x = <span class="number">0</span>; x &lt; vendors.length &amp;&amp; !<span class="built_in">window</span>.requestAnimationFrame; ++x) &#123;</div><div class="line">    <span class="built_in">window</span>.requestAnimationFrame = <span class="built_in">window</span>[vendors[x]+<span class="string">'RequestAnimationFrame'</span>];</div><div class="line">    <span class="built_in">window</span>.cancelAnimationFrame = <span class="built_in">window</span>[vendors[x]+<span class="string">'CancelAnimationFrame'</span>] || <span class="built_in">window</span>[vendors[x]+<span class="string">'CancelRequestAnimationFrame'</span>];</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (!<span class="built_in">window</span>.requestAnimationFrame) &#123;</div><div class="line">    <span class="built_in">window</span>.requestAnimationFrame = <span class="function"><span class="keyword">function</span>(<span class="params">callback, element</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> currTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</div><div class="line">      <span class="keyword">var</span> timeToCall = <span class="built_in">Math</span>.max(<span class="number">0</span>, <span class="number">16</span> - (currTime - lastTime));</div><div class="line">      <span class="keyword">var</span> id = <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; callback(currTime + timeToCall); &#125;, timeToCall);</div><div class="line">      lastTime = currTime + timeToCall;</div><div class="line">      <span class="keyword">return</span> id;</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (!<span class="built_in">window</span>.cancelAnimationFrame) &#123;</div><div class="line">    <span class="built_in">window</span>.cancelAnimationFrame = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</div><div class="line">      clearTimeout(id);</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p>1.<a href="http://www.ghugo.com/requestanimationframe-best-practice/" target="_blank" rel="external">requestAnimationFrame最佳实践</a><br>2.<a href="http://jinlong.github.io/2016/04/24/Debouncing-and-Throttling-Explained-Through-Examples/" target="_blank" rel="external">实例解析防抖动（Debouncing）和节流阀（Throttling）</a><br>3.<a href="http://www.barretlee.com/blog/2016/04/01/optimization-in-taobao-homepage/" target="_blank" rel="external">淘宝首页性能优化实践</a><br>4.<a href="http://www.barretlee.com/blog/2016/06/02/thing-about-taobao-homepage/" target="_blank" rel="external">聊一聊淘宝首页和它背后的一套</a><br>5.<a href="https://gist.github.com/miksago/3035015" target="_blank" rel="external">naf.js</a></p>

            
                

            
        </div>
    </div>
    <div class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/requestAnimationFrame/" rel="tag">requestAnimationFrame</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" rel="tag">性能优化</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/%E6%87%92%E6%89%A7%E8%A1%8C/" rel="tag">懒执行</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/08/18/%EF%BC%88%E8%AF%91%EF%BC%89%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%20chrome%20devtools%20%E4%B8%AD%E7%9A%84%20Timeline%20%E5%B7%A5%E5%85%B7/"  data-tooltip="（译）如何使用 Chrome Devtools 中的 Timeline 工具">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/08/09/%E5%BE%AE%E4%BF%A1%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%9E%E7%8E%B0%E5%90%8E%E9%80%80%E8%AE%B0%E5%BF%86%E6%B5%8F%E8%A7%88%E4%BD%8D%E7%BD%AE/" data-tooltip="微信浏览器实现后退记忆浏览位置">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://www.404forest.com/2016/08/15/%E4%BD%BF%E7%94%A8%20requestAnimationFrame%20%E5%AE%9E%E7%8E%B0%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%8E%E6%87%92%E6%89%A7%E8%A1%8C/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://www.404forest.com/2016/08/15/%E4%BD%BF%E7%94%A8%20requestAnimationFrame%20%E5%AE%9E%E7%8E%B0%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%8E%E6%87%92%E6%89%A7%E8%A1%8C/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://www.404forest.com/2016/08/15/%E4%BD%BF%E7%94%A8%20requestAnimationFrame%20%E5%AE%9E%E7%8E%B0%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%8E%E6%87%92%E6%89%A7%E8%A1%8C/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
            <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Jin. All Rights Reserved.
    </span>
    <a class="copyrights" target="_blank" rel="noopener" href="http://www.beian.miit.gov.cn/">
        浙ICP备18012561号
    </a>
</footer>

            </div>
        </div>
        <div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/ava.png"/>
        
            <h4 id="about-card-name">Jin</h4>
        
            <h5 id="about-card-bio">Interested in Web Development/Typography/Japanese.</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                WebDeveloper
            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Beijing
            </h5>
        
    </div>
</div>

        <div id="cover" style="background-image:url('/assets/images/bg4.jpg');"></div>
    </body>
    <!--SCRIPTS-->

<script src="/assets/js/script.min.js"></script>

<!--SCRIPTS END-->

    <script type="text/javascript">
        var disqus_shortname = '404forest';
        (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>


    <script type="text/javascript">
        (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
                (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
            e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
        })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

        _st('install','ZkJM8hxyxxLens-VGG__','2.0.0');
    </script>


</html>
