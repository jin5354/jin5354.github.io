
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="404Forest">
    <title>HTTP 安全最佳实践 - 404Forest</title>
    <meta name="author" content="Jin">
    
        <link rel="icon" href="/assets/images/favicon.ico">
    
    
    <meta name="description" content="在上文《配置 ssllabs A+ 评分站点》中，我们已经知道了如何部署一个高 SSL 健壮性的网站。但是上文配置后的站点用 HTTP Security Report 做检测，只拿到了 53 分。本文继续探讨提高 HTTP 安全性的各种措施。">
<meta property="og:type" content="blog">
<meta property="og:title" content="HTTP 安全最佳实践">
<meta property="og:url" content="http://www.404forest.com/2017/05/09/http-security-best-practice/index.html">
<meta property="og:site_name" content="404Forest">
<meta property="og:description" content="在上文《配置 ssllabs A+ 评分站点》中，我们已经知道了如何部署一个高 SSL 健壮性的网站。但是上文配置后的站点用 HTTP Security Report 做检测，只拿到了 53 分。本文继续探讨提高 HTTP 安全性的各种措施。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.404forest.com/imgs/blog/httpsecurityreport.png">
<meta property="og:image" content="http://www.404forest.com/imgs/blog/httpsecurityreport2.png">
<meta property="article:published_time" content="2017-05-10T01:11:11.000Z">
<meta property="article:modified_time" content="2025-02-04T23:02:44.256Z">
<meta property="article:author" content="Jin">
<meta property="article:tag" content="nginx">
<meta property="article:tag" content="http">
<meta property="article:tag" content="https">
<meta property="article:tag" content="security">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.404forest.com/imgs/blog/httpsecurityreport.png">
<meta name="twitter:creator" content="@jin5354">
    
    
    
        <meta property="og:image" content="/assets/images/ava.png"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style.min.css">

    <!--STYLES END-->
    
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-66492678-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

</head>

    <body>
        <div id="blog">
            <header id="header" data-behavior="3">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/%20">404Forest</a>
    </h1>
    
        <a class="header-right-picture" href="/#about">
            <img class="header-picture" src="/assets/images/ava.png"/>
        </a>
    
</header>
            <nav id="sidebar" data-behavior="3">
    
        <div class="sidebar-profile">
            <a href="/#about">
                
                    <img class="sidebar-profile-picture" src="/assets/images/ava.png"/>
                
            </a>
            <span class="sidebar-profile-name">Jin</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/%20"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Archive</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">Categories</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">Search</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://github.com/jin5354" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="mailto:xiaoyanjinx@gmail.com" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i>
                    <span class="sidebar-button-desc">Mail</span>
                </a>
        </li>
        
    </ul>
    
    <div style="margin-left: 27px;">
        <a target="_blank" rel="noopener" href="https://github.com/jin5354/404forest"><img src="https://img.shields.io/github/stars/jin5354/404forest.svg?style=social&label=Stars"></a>
    </div>
</nav>

            
            <div id="main" data-behavior="3"
                 class="
                        hasCoverMetaIn
                        ">
                <article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            HTTP 安全最佳实践
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" content="Tue May 09 2017 18:11:11 GMT-0700">
	
		    5月 09, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Code/">Code</a>


    
</div>
</div>
    
    <div class="main-content-wrap" style="margin-top: 60px;">索引</div>
    <ol class="main-content-wrap toc-article"><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-1"><a class="main-content-wrap toc-article-link" href="#1-%E8%BF%9E%E6%8E%A5%E5%AE%89%E5%85%A8%E6%80%A7%E4%B8%8E%E5%8A%A0%E5%AF%86"><span class="main-content-wrap toc-article-text">1. 连接安全性与加密</span></a><ol class="main-content-wrap toc-article-child"><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-2"><a class="main-content-wrap toc-article-link" href="#1-1-SSL-TLS"><span class="main-content-wrap toc-article-text">1.1 SSL&#x2F;TLS</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-2"><a class="main-content-wrap toc-article-link" href="#1-2-HTTP-%E4%B8%A5%E6%A0%BC%E4%BC%A0%E8%BE%93%E5%AE%89%E5%85%A8-%EF%BC%88HTTP-Strict-Transport-Security-HSTS%EF%BC%89"><span class="main-content-wrap toc-article-text">1.2 HTTP 严格传输安全 （HTTP Strict Transport Security &#x2F; HSTS）</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-2"><a class="main-content-wrap toc-article-link" href="#1-3-HTTP-%E5%85%AC%E9%92%A5%E5%9B%BA%E5%AE%9A%EF%BC%88HTTP-Public-Key-Pinning-HPKP%EF%BC%89"><span class="main-content-wrap toc-article-text">1.3 HTTP 公钥固定（HTTP Public-Key Pinning &#x2F; HPKP）</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-2"><a class="main-content-wrap toc-article-link" href="#1-4-HTTP-HTTPS-%E5%86%85%E5%AE%B9%E6%B7%B7%E5%90%88"><span class="main-content-wrap toc-article-text">1.4 HTTP &#x2F; HTTPS 内容混合</span></a></li></ol></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-1"><a class="main-content-wrap toc-article-link" href="#2-%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E6%80%A7"><span class="main-content-wrap toc-article-text">2. 内容安全性</span></a><ol class="main-content-wrap toc-article-child"><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-2"><a class="main-content-wrap toc-article-link" href="#2-1-%E7%BD%91%E9%A1%B5%E5%AE%89%E5%85%A8%E6%94%BF%E7%AD%96%EF%BC%88Content-Security-Policy-CSP%EF%BC%89"><span class="main-content-wrap toc-article-text">2.1 网页安全政策（Content Security Policy &#x2F; CSP）</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-2"><a class="main-content-wrap toc-article-link" href="#2-2-Frame-Options"><span class="main-content-wrap toc-article-text">2.2 Frame Options</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-2"><a class="main-content-wrap toc-article-link" href="#2-3-XSS-%E4%BF%9D%E6%8A%A4%EF%BC%88XSS-Protection%EF%BC%89"><span class="main-content-wrap toc-article-text">2.3 XSS 保护（XSS Protection）</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-2"><a class="main-content-wrap toc-article-link" href="#2-4-%E7%BC%93%E5%AD%98%E6%8E%A7%E5%88%B6%EF%BC%88Cache-Control%EF%BC%89"><span class="main-content-wrap toc-article-text">2.4 缓存控制（Cache Control）</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-2"><a class="main-content-wrap toc-article-link" href="#2-5-Content-Type-Options"><span class="main-content-wrap toc-article-text">2.5 Content Type Options</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-2"><a class="main-content-wrap toc-article-link" href="#2-6-%E5%AD%90%E8%B5%84%E6%BA%90%E5%AE%8C%E6%95%B4%E6%80%A7%EF%BC%88Subresource-Integrity-SRI%EF%BC%89"><span class="main-content-wrap toc-article-text">2.6 子资源完整性（Subresource Integrity &#x2F; SRI）</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-2"><a class="main-content-wrap toc-article-link" href="#2-7-Iframe-Sandbox"><span class="main-content-wrap toc-article-text">2.7 Iframe Sandbox</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-2"><a class="main-content-wrap toc-article-link" href="#2-8-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%97%B6%E9%92%9F"><span class="main-content-wrap toc-article-text">2.8 服务器时钟</span></a></li></ol></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-1"><a class="main-content-wrap toc-article-link" href="#3-%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="main-content-wrap toc-article-text">3. 信息泄露</span></a><ol class="main-content-wrap toc-article-child"><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-2"><a class="main-content-wrap toc-article-link" href="#3-1-Server-Banner"><span class="main-content-wrap toc-article-text">3.1 Server Banner</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-2"><a class="main-content-wrap toc-article-link" href="#3-2-Web-%E6%A1%86%E6%9E%B6%E4%BF%A1%E6%81%AF"><span class="main-content-wrap toc-article-text">3.2 Web 框架信息</span></a></li></ol></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-1"><a class="main-content-wrap toc-article-link" href="#4-Cookies"><span class="main-content-wrap toc-article-text">4. Cookies</span></a><ol class="main-content-wrap toc-article-child"><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-2"><a class="main-content-wrap toc-article-link" href="#4-1-Cookie-%E5%AE%89%E5%85%A8"><span class="main-content-wrap toc-article-text">4.1 Cookie 安全</span></a></li></ol></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-1"><a class="main-content-wrap toc-article-link" href="#5-%E7%BB%93%E8%AF%AD"><span class="main-content-wrap toc-article-text">5. 结语</span></a></li><li class="main-content-wrap toc-article-item main-content-wrap toc-article-level-1"><a class="main-content-wrap toc-article-link" href="#6-%E5%8F%82%E8%80%83"><span class="main-content-wrap toc-article-text">6. 参考</span></a></li></ol>
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p>在上文<a href="https://www.404forest.com/2017/05/08/get-aplus-score-in-ssllabs-with-nginx-and-letsencrypt/">《配置 ssllabs A+ 评分站点》</a>中，我们已经知道了如何部署一个高 SSL 健壮性的网站。但是上文配置后的站点用 <a href="https://httpsecurityreport.com/" target="_blank" rel="external">HTTP Security Report</a> 做检测，只拿到了 53 分。本文继续探讨提高 HTTP 安全性的各种措施。</p>
<a id="more"></a>
<h1 id="1-连接安全性与加密"><a href="#1-连接安全性与加密" class="headerlink" title="1. 连接安全性与加密"></a>1. 连接安全性与加密</h1><h2 id="1-1-SSL-TLS"><a href="#1-1-SSL-TLS" class="headerlink" title="1.1 SSL/TLS"></a>1.1 SSL/TLS</h2><p>传输层安全协议（Transport Layer Security / TLS）及其前身安全套接层（Secure Sockets Layer / SSL）为浏览器和服务器提供了端到端的加密手段，为互联网通信提供了安全可靠性保障。没有 TLS，其他安全手段不堪一击。TLS 是 HTTP 安全的基石。</p>
<p>然而 TLS 的部署不是一蹴而就的。协议版本与加密算法需要精心挑选与配置。你需要准备好权威机构签发的证书，并且牢固的保管好加密密钥。<a href="https://www.ssllabs.com/ssltest/" target="_blank" rel="external">Qualys SSL Labs</a> 提供了贴心的工具帮你优化 TLS 配置细节。（本博客的相关文章：<a href="https://www.404forest.com/2017/05/08/get-aplus-score-in-ssllabs-with-nginx-and-letsencrypt/">Nginx + Let’s Encrypt 协力快速配置出 ssllabs A+ 评分的站点</a>）</p>
<p><strong>建议</strong></p>
<ul>
<li>对所有本地资源和引用资源都要妥善配置 TLS。</li>
</ul>
<p><strong>兼容性</strong></p>
<ul>
<li>所有主流浏览器均支持。</li>
</ul>
<p><strong>部署情况占比（Alexa Top 500 站点中）</strong></p>
<ul>
<li>使用 SSL/TLS：70.6%</li>
<li>未使用 SSL/TLS：29.4%</li>
</ul>
<h2 id="1-2-HTTP-严格传输安全-（HTTP-Strict-Transport-Security-HSTS）"><a href="#1-2-HTTP-严格传输安全-（HTTP-Strict-Transport-Security-HSTS）" class="headerlink" title="1.2 HTTP 严格传输安全 （HTTP Strict Transport Security / HSTS）"></a>1.2 HTTP 严格传输安全 （HTTP Strict Transport Security / HSTS）</h2><p>HSTS 使浏览器仅允许通过 HTTPS（SSL/TLS）方式连接服务器。这可以避免很多潜在的中间人攻击场景，包括 SSL stripping 攻击（中间人将页面中的 https 链接偷换为 http 链接），session cookie 窃取等。启用 HSTS 还可以阻止浏览器访问证书相关配置存在错误的站点。为 HTTPS 站点设置 HSTS 相关的返回头可以激活浏览器的 HSTS 功能。</p>
<p>HSTS 通过 <code>max-age</code> 字段设置过期时间。这个字段的值可以是一个固定秒数，也可以是一个固定日期（一般来说与证书到期的时间相符）。</p>
<p>通过向 <a href="https://hstspreload.org" target="_blank" rel="external">Chromium’s HSTS preload list</a> 中提交可以将网站加入主流浏览器内置的默认 HSTS 列表中。</p>
<p>注意 HSTS 也有一些小隐患：它的 <code>includeSubDomains</code> 会覆盖所有子域名，可能导致意料之外的覆盖过广的配置。并且，客户端可能出现无法访问的情况：假如客户端的时钟设置不当，造成浏览器认为 SSL 证书还未生效、已过期或者根证书丢失 —— 此时浏览器不会报证书错误，而是完全拒绝网页连接，同时（有可能）显示出只有专家才能看懂的非常晦涩的错误信息。</p>
<p><strong>建议</strong></p>
<ul>
<li>设置较长过期时间的 HSTS 响应头，建议半年以上。</li>
<li>如：<code>Strict-Transport-Security: max-age=31536000</code></li>
</ul>
<p><strong>兼容性</strong></p>
<ul>
<li>所有主流浏览器均支持。</li>
</ul>
<p><strong>方法</strong></p>
<ul>
<li>在 nginx 配置中， http - server - location block 中添加：<figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">add_header </span><span class="keyword">Strict-Transport-Security </span><span class="string">"max-age=31536000; includeSubDomains;preload"</span> always<span class="comment">;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>部署情况占比（Alexa Top 500 站点中（已部署 HTTPS））</strong></p>
<ul>
<li>使用 HSTS： 28.4% （其中 86.7% 的站点设定了长过期时间） 例：twitter.com github.com taobao.com</li>
<li>部署 HTTPS 但未使用 HSTS： 71.6%</li>
</ul>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Security/HTTP_Strict_Transport_Security" target="_blank" rel="external">HTTP Strict Transport Security | MDN</a></li>
</ul>
<h2 id="1-3-HTTP-公钥固定（HTTP-Public-Key-Pinning-HPKP）"><a href="#1-3-HTTP-公钥固定（HTTP-Public-Key-Pinning-HPKP）" class="headerlink" title="1.3 HTTP 公钥固定（HTTP Public-Key Pinning / HPKP）"></a>1.3 HTTP 公钥固定（HTTP Public-Key Pinning / HPKP）</h2><p>HTTP 公钥固定要求浏览器只在服务器提供已信任的某几张 SSL/TLS 证书（或者由已信任的中间证书/根证书签发的子证书）时才发起链接。这样，如果 SSL/TLS 证书发生预期之外的变化时，浏览器会拒绝访问。这可以避免多数证书欺诈场景。</p>
<p>举个例子，如果浏览器访问了配置了 HPKP 响应头的网站，那么站点要求浏览器在未来一段时间（过期时间）之内，只有服务器在证书链中存在已信任的证书时，才允许建立连接。这极大的降低了攻击者伪装服务器拦截数据的可能性。</p>
<p>像 HSTS 一样，部署 HPKP 前需要三思。错误的部署会导致用户无法访问你的站点，并且难以修复。</p>
<p>HPKP 不会保护来自本机的攻击。例如，使用 charles、fiddler 等调试工具检查 https 流量时，需要安装并信任调试工具提供的根证书。在 Chrome、Firefox 浏览器中，这种本地导入的根证书不会被 HPKP 策略拦截。这说明了 HPKP 并不保护来自本机的恶意软件的攻击。</p>
<p><strong>建议</strong></p>
<ul>
<li>如果你确信你的站点需要 HPKP，先设定一个较短的过期时间做一下试验。一段时间没问题后，再使用长过期时间。一定要设置好备用指纹，提前为证书更换这种场景做好准备。<br>示例： <code>Public-Key-Pins: max-age=5184000; pin-sha256=&quot;+oZq/vo3Kcv0CQPjpdwyInqVXmLiobmUJ3FaDpD/U6c=&quot;; pin-sha256=&quot;47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=&quot;</code></li>
</ul>
<p><strong>兼容性</strong></p>
<ul>
<li>Chrome、FireFox、Opera 支持， IE、EDGE、Safari 不支持。</li>
</ul>
<p><strong>方法</strong></p>
<ul>
<li><p>使用 openssl 生成证书指纹：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ <span class="comment"># 检查证书是否符合 x509 规范，顺便通过 CN 字段确认证书在证书链上的位置</span></div><div class="line">$ openssl x509 -in chain.pem -noout -subject</div><div class="line"><span class="comment"># 确认该证书为 Let's Encrypt Authority X3 中间证书</span></div><div class="line">subject= /C=US/O=Let<span class="string">'s Encrypt/CN=Let'</span>s Encrypt Authority X3</div><div class="line">$ <span class="comment"># 生成公钥</span></div><div class="line">$ openssl x509 -in chain.pem -noout -pubkey | openssl asn1parse -noout -inform pem -out public.key</div><div class="line">$ <span class="comment"># 生成指纹</span></div><div class="line">$ openssl dgst -sha256 -binary public.key | openssl enc -base64</div><div class="line">YLh1dUR9y6Kja30RrAn7JKnbQG/uEtLMkBgFF2Fuihg=</div></pre></td></tr></table></figure>
</li>
<li><p>生成多个指纹（最少要求两个）后，最后修改 Nginx 配置并重新加载即可。（以下为本站配置）</p>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">add_header <span class="type">Public</span>-<span class="type">Key</span>-<span class="type">Pins</span> <span class="symbol">'pin</span>-sha256=<span class="string">"YLh1dUR9y6Kja30RrAn7JKnbQG/uEtLMkBgFF2Fuihg="</span>; pin-sha256=<span class="string">"/DPi+1wSZeogvO1OfgffRC6vM2LfvjaCfUV5Q2tqqtY="</span>; max-age=<span class="number">2592000</span>; includeSubDomains';</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>部署情况占比（Alexa Top 500 站点中（已部署 HTTPS））</strong></p>
<ul>
<li>使用 HPKP：0.8% 例：Github.com</li>
<li>未使用 HPKP: 99.2%</li>
</ul>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a href="https://imququ.com/post/http-public-key-pinning.html" target="_blank" rel="external">HTTP Public Key Pinning 介绍</a></li>
</ul>
<h2 id="1-4-HTTP-HTTPS-内容混合"><a href="#1-4-HTTP-HTTPS-内容混合" class="headerlink" title="1.4 HTTP / HTTPS 内容混合"></a>1.4 HTTP / HTTPS 内容混合</h2><p>如果你的站点部署了 HTTPS 服务但页面中的某些资源（图片、js、css）由 HTTP 协议引入，会极大降低 HTTPS 安全性。这会导致 session cookie 等数据的泄露，还容易遭受注入攻击或中间人攻击。</p>
<p><strong>建议</strong></p>
<ul>
<li>如果你的站点部署了 HTTPS，确保所有需要的资源都用 HTTPS 引入。</li>
</ul>
<p><strong>部署情况占比（Alexa Top 500 站点中（已部署 HTTPS））</strong></p>
<ul>
<li>全站 HTTPS：95.7%</li>
<li>存在混合内容：4.3%</li>
</ul>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content" target="_blank" rel="external">Mixed content | MDN</a></li>
</ul>
<h1 id="2-内容安全性"><a href="#2-内容安全性" class="headerlink" title="2. 内容安全性"></a>2. 内容安全性</h1><h2 id="2-1-网页安全政策（Content-Security-Policy-CSP）"><a href="#2-1-网页安全政策（Content-Security-Policy-CSP）" class="headerlink" title="2.1 网页安全政策（Content Security Policy / CSP）"></a>2.1 网页安全政策（Content Security Policy / CSP）</h2><p>使用 CSP 可以提供一个白名单，明确的告诉浏览器哪些外部资源可以加载和执行。一个完善声明的 CSP 可以极大的加固页面安全性，防御 XSS 等注入式攻击。攻击者即使发现了漏洞也没办法注入第三方脚本，除非他还控制了白名单中的机器。</p>
<p>老项目中引入的资源可能散落在多处，难以整理出一个白名单。对于这种情况，可以使用 CSP 的 <code>report-only</code> 模式，该模式下不执行限制，只记录违规操作并上报至服务器。</p>
<p>所有新项目都建议使用 CSP。</p>
<p><strong>建议</strong></p>
<ul>
<li><p>先阻止所有外部资源的引用。<br>Content-Security-Policy: default-src ‘none’;<br>然后逐步放开限制。允许某些域的 js，允许来自本站的 css、font、AJAX，等等</p>
<figure class="highlight csp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">Content-Security-Policy</span>: <span class="keyword">default-src</span> <span class="string">'none'</span>; <span class="keyword">script-src</span> <span class="string">'self'</span> https://code.jquery.com https://www.google-analytics.com; <span class="keyword">img-src</span> <span class="string">'self'</span> https://www.google-analytics.com; <span class="keyword">connect-src</span> <span class="string">'self'</span>; <span class="keyword">font-src</span> <span class="string">'self'</span>; <span class="keyword">style-src</span> <span class="string">'self'</span>;</div></pre></td></tr></table></figure>
</li>
<li><p>更松一点的配置是：默认情况下所有外部资源仅允许本域。不建议使用 <code>default-src &#39;*&#39;</code> 全部放开通行的配置。</p>
<figure class="highlight csp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">Content-Security-Policy</span>: <span class="keyword">default-src</span> <span class="string">'self'</span>;...其他自定义内容</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>兼容性</strong></p>
<ul>
<li>所有主流浏览器均支持 CSP 1.0，EDGE 15+ / Chrome 40+ / Safari 10+ / Android 5+ / iOS9.3+ 支持 CSP 2.0，Firefox 31+ 部分支持 CSP 2.0</li>
</ul>
<p><strong>方法</strong></p>
<ul>
<li>修改 Nginx 配置，http - server - location block 中添加：(本站配置)<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">add_header Content-Security-Policy "default-src 'self' <span class="emphasis">*.google-analytics.com *</span>.swiftypecdn.com <span class="emphasis">*.swiftype.com *</span>.gstatic.com <span class="emphasis">*.disqus.com *</span>.disquscdn.com <span class="emphasis">*.google.com *</span>.facebook.com <span class="emphasis">*.pippio.com *</span>.crwdcntrl.net <span class="emphasis">*.bluekai.com *</span>.exelator.com <span class="emphasis">*.narrative.io disqus.com 'unsafe-inline'; img-src *</span> data: blob:";</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>部署情况占比（Alexa Top 500 站点中）</strong></p>
<ul>
<li>已部署 CSP: 9.0% 例：zhihu.com （<a href="http://weibo.com/2451315930/ECckdnjFl?from=page_1005052451315930_profile&amp;wvr=6&amp;mod=weibotime&amp;type=comment" target="_blank" rel="external">知乎曾出现过的 XSS 问题，因为部署了 CSP 没有收到影响</a>） github.com medium.com</li>
<li>未部署 CSP: 91.0%</li>
</ul>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a href="https://imququ.com/post/content-security-policy-reference.html" target="_blank" rel="external">Content Security Policy 介绍</a></li>
<li><a href="https://imququ.com/post/content-security-policy-level-2.html" target="_blank" rel="external">Content Security Policy Level 2 介绍</a></li>
</ul>
<h2 id="2-2-Frame-Options"><a href="#2-2-Frame-Options" class="headerlink" title="2.2 Frame Options"></a>2.2 Frame Options</h2><p>Frame Options 控制页面是否允许被 <code>&lt;iframe&gt;</code>、<code>&lt;frame&gt;</code>、<code>&lt;object&gt;</code> 标签引入。禁止引入可以防止“点击劫持（Clickjacking）”式攻击。</p>
<p>其前身 <code>X-Frame-Options</code> 是一个非标准响应头。在 CSP 2.0 标准中已经被 <code>Frame Options</code> 取代。然而 CSP 2.0 还没普及，所以 <code>X-Frame-Options</code> 还在广泛使用中。</p>
<p><strong>建议</strong></p>
<ul>
<li>取决于你的站点是否需要在 frame 中被渲染。使用 <code>deny</code> 完全禁止引入，或者使用 <code>sameorigin</code> 只允许同域引入。避免使用 <code>allow-from</code> 字段，因为兼容性很差。<br>X-Frame-Options: deny</li>
</ul>
<p><strong>方法</strong></p>
<ul>
<li>修改 Nginx 配置，http - server - location block 中添加：(本站配置)<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">add_header X-<span class="keyword">Frame</span>-<span class="keyword">Options</span> <span class="string">"deny"</span>;</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>兼容性</strong></p>
<ul>
<li><code>X-Frame-Options</code> 被所有主流浏览器支持。 <code>Frame-Options</code> 被所有支持 CSP 2.0 的浏览器支持。（参见 2.1 节）</li>
</ul>
<p><strong>部署情况占比（Alexa Top 500 站点中）</strong></p>
<ul>
<li>已部署 Frame Options：48.3% 例：google.com zhihu.com github.com</li>
<li>未部署 Frame Options：51.7%</li>
</ul>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/X-Frame-Options" target="_blank" rel="external">X-Frame-Options 响应头 | MDN</a></li>
</ul>
<h2 id="2-3-XSS-保护（XSS-Protection）"><a href="#2-3-XSS-保护（XSS-Protection）" class="headerlink" title="2.3 XSS 保护（XSS Protection）"></a>2.3 XSS 保护（XSS Protection）</h2><p>现在大多数浏览器都内建了跨站脚本攻击（XSS or CSS）保护功能。通常这个选项可以由用户手动在浏览器端关掉。因此，在响应头中显示声明启用 XSS 保护功能比较好。</p>
<p>相反，网站也可以要求浏览器在某些页面主动关掉 XSS 保护功能。最好不要这样做。浏览器提供的 XSS 保护机制不一定好用，但好歹也提高了攻击成本，开了总比不开强。</p>
<p><strong>建议</strong></p>
<ul>
<li>添加响应头</li>
<li>如：<code>X-Xss-Protection: 1;mode=block</code></li>
</ul>
<p><strong>方法</strong></p>
<ul>
<li>修改 Nginx 配置，http - server - location block 中添加：(本站配置)<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">add_header </span>X-Xss-Protection <span class="string">"1;mode=block"</span><span class="comment">;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>兼容性</strong></p>
<ul>
<li>除 Firefox 以外，所有主流浏览器均支持。</li>
</ul>
<p><strong>部署情况占比（Alexa Top 500 站点中）</strong></p>
<ul>
<li>已部署 Xss-Protection：96.1% 例：google.com github.com</li>
<li>未部署 Xss-Protection：3.9%</li>
</ul>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-XSS-Protection" target="_blank" rel="external">X-XSS-Protection | MDN</a></li>
</ul>
<h2 id="2-4-缓存控制（Cache-Control）"><a href="#2-4-缓存控制（Cache-Control）" class="headerlink" title="2.4 缓存控制（Cache Control）"></a>2.4 缓存控制（Cache Control）</h2><p>指定页面的缓存策略。强烈建议手动指定页面缓存策略，否则会由浏览器和代理来控制是否缓存内容。一个不当的缓存策略可能会导致性能问题和安全问题。</p>
<p><strong>建议</strong></p>
<ul>
<li>选择适合站点的缓存策略，并写在 HTTP 响应头中。</li>
</ul>
<p><strong>方法</strong></p>
<ul>
<li>修改 Nginx 配置，http - server - location block 中添加：(本站配置)<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">add_header </span><span class="keyword">Cache-Control </span><span class="string">"no-cache"</span><span class="comment">;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>兼容性</strong></p>
<ul>
<li>所有主流浏览器均支持。</li>
</ul>
<p><strong>部署情况占比（Alexa Top 500 站点中）</strong></p>
<ul>
<li>显式指定缓存策略：74.6% 例：google.com baidu.com</li>
<li>未显式指定缓存策略：25.4%</li>
</ul>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control" target="_blank" rel="external">Cache-Control | MDN</a></li>
</ul>
<h2 id="2-5-Content-Type-Options"><a href="#2-5-Content-Type-Options" class="headerlink" title="2.5 Content Type Options"></a>2.5 Content Type Options</h2><p>通常浏览器根据响应头的 Content Type 字段分辨资源类型，但假若某些资源 Content Type 是错的或未定义，浏览器会启用 MIME-sniffing 来猜测该资源的类型，解析内容并执行。设想你的站点有图片上传功能，用户上传了一个 html 文档。这时即使服务器端声明该资源的 Content Type 为图片，浏览器依然会按照 html 来渲染并执行其中的脚本内容。通过非标准的 <code>X-Content-Type-Options</code> 响应头可以关闭浏览器的资源 MIME-sniffing 功能。</p>
<p><strong>建议</strong></p>
<ul>
<li>始终设置该响应头：</li>
<li>如：X-Content-Type-Options: nosniff</li>
</ul>
<p><strong>方法</strong></p>
<ul>
<li>修改 Nginx 配置，http - server - location block 中添加：(本站配置)<figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">add_header X-Content-<span class="keyword">Type</span>-<span class="keyword">Options</span> <span class="string">"nosniff"</span>;</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>兼容性</strong></p>
<ul>
<li>除 safari 外的所有主流浏览器均支持。</li>
</ul>
<p><strong>部署情况占比（Alexa Top 500 站点中）</strong></p>
<ul>
<li>部署 Content Type Options：21.9% 例： github.com twitter.com</li>
<li>未部署 Content Type Options：78.1%</li>
</ul>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options" target="_blank" rel="external">X-Content-Type-Options | MDN</a></li>
</ul>
<h2 id="2-6-子资源完整性（Subresource-Integrity-SRI）"><a href="#2-6-子资源完整性（Subresource-Integrity-SRI）" class="headerlink" title="2.6 子资源完整性（Subresource Integrity / SRI）"></a>2.6 子资源完整性（Subresource Integrity / SRI）</h2><p>通常情况下，浏览器都会从其他域内载入资源（比如 CDN）。既然资源托管在第三方服务器，就有被篡改的风险。SRI 通过对资源进行摘要签名的方式，保证外链资源不被篡改。</p>
<p><strong>建议</strong></p>
<ul>
<li><p>为外链的 JavaScript、Style 文件设置 integrity 属性。例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span> <span class="attr">href</span>=<span class="string">"https://assets-cdn.github.com/assets/frameworks-81a59bf26d881d29286674f6deefe779c444382fff322085b50ba455460ccae5.css"</span> <span class="attr">integrity</span>=<span class="string">"sha256-gaWb8m2IHSkoZnT23u/necREOC//MiCFtQukVUYMyuU="</span> <span class="attr">media</span>=<span class="string">"all"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>假如子资源完整性检查失败，资源就不会载入，往往导致页面无法正常工作。这是一种 “宁为玉碎，不为瓦全” 的策略。请一定要做好降级措施。比如当检查失败时，从本地或从其他域载入资源。</p>
</li>
</ul>
<p><strong>方法</strong></p>
<ul>
<li>如果使用 webpack 打包，可以使用 <a href="https://github.com/waysact/webpack-subresource-integrity" target="_blank" rel="external">webpack-subresource-integrity</a> 插件在打包时自动加入资源签名。</li>
</ul>
<p><strong>兼容性</strong></p>
<ul>
<li>FireFox 43+、Chrome 45+、Opera 32+ 支持 SRI。</li>
</ul>
<p><strong>部署情况占比（Alexa Top 500 站点中）</strong></p>
<ul>
<li>部署 SRI 检查：0.4% 例： github.com</li>
<li>未部署 SRI 检查：99.6%</li>
</ul>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a href="https://imququ.com/post/subresource-integrity.html" target="_blank" rel="external">Subresource Integrity 介绍</a></li>
</ul>
<h2 id="2-7-Iframe-Sandbox"><a href="#2-7-Iframe-Sandbox" class="headerlink" title="2.7 Iframe Sandbox"></a>2.7 Iframe Sandbox</h2><p>网页中的 iframe 运行的脚本很可能影响到整个页面。为 iframe 指定 <code>sandbox</code> 属性可以对 iframe 中内容行为进行限制。</p>
<p><strong>建议</strong></p>
<ul>
<li>为页面中的 iframe 添加合适的 <code>sandbox</code> 属性，只给必要的权限。<br>例：<code>&lt;iframe src=&quot;https://example.com&quot; sandbox=&quot;allow-same-origin allow-scripts&quot;&gt;&lt;/iframe&gt;</code></li>
</ul>
<p><strong>兼容性</strong></p>
<ul>
<li>所有主流浏览器均支持。</li>
</ul>
<p><strong>部署情况占比（Alexa Top 500 站点中）</strong></p>
<ul>
<li>未检查到使用 iframe: 79.8%</li>
<li>使用 iframe，未使用 sandbox：20.0%</li>
<li>使用 iframe 且使用 sandbox：0.2%</li>
</ul>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/iframe" target="_blank" rel="external">iframe | MDN</a></li>
</ul>
<h2 id="2-8-服务器时钟"><a href="#2-8-服务器时钟" class="headerlink" title="2.8 服务器时钟"></a>2.8 服务器时钟</h2><p>服务器在所有响应中都会加入时间戳。时间戳不正确，在浏览器中可能不会引发错误，但是在其他系统或服务中可能会引发问题。</p>
<p><strong>建议</strong></p>
<ul>
<li>使用网络时间协定（NTP）来保证服务器时钟准确。</li>
</ul>
<p><strong>部署情况占比（Alexa Top 500 站点中）</strong></p>
<ul>
<li>服务器时钟准确： 95.9%</li>
<li>服务器时钟不准确： 3.9%</li>
<li>不返回时间戳：0.2%</li>
</ul>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a href="http://www.ntp.org/ntpfaq/NTP-s-def.htm" target="_blank" rel="external">What is NTP?</a></li>
</ul>
<h1 id="3-信息泄露"><a href="#3-信息泄露" class="headerlink" title="3. 信息泄露"></a>3. 信息泄露</h1><h2 id="3-1-Server-Banner"><a href="#3-1-Server-Banner" class="headerlink" title="3.1 Server Banner"></a>3.1 Server Banner</h2><p>大多数服务器都会在响应头加入 Server Banner 来标明自己身份和版本号，比如：<code>server:nginx/1.10.0 (Ubuntu)</code>。这个头除了暴露服务器信息外，没什么实际用处。把这个响应头整个删掉通常也是没问题的，但是没必要做的这么狠。我们建议把版本号信息消除。这样，在某个版本暴露出 bug 后，可以降低引来他人攻击的可能性。</p>
<p><strong>建议</strong></p>
<ul>
<li>消除 Server Banner 中的版本号。保留： <code>Server: nginx</code></li>
</ul>
<p><strong>方法</strong></p>
<ul>
<li>修改 nginx 配置，在 http block 中加入：<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">server_tokens</span> <span class="literal">off</span>;</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>部署情况占比（Alexa Top 500 站点中）</strong></p>
<ul>
<li>消除版本号：83.0% 例： github.com taobao.com</li>
<li>未消除版本号：17.0%</li>
</ul>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a href="http://www.acunetix.com/blog/articles/configure-web-server-disclose-identity/" target="_blank" rel="external">How to configure your web server to not disclose it’s identity</a></li>
</ul>
<h2 id="3-2-Web-框架信息"><a href="#3-2-Web-框架信息" class="headerlink" title="3.2 Web 框架信息"></a>3.2 Web 框架信息</h2><p>很多 Web 框架都会设置响应头来标示自己身份、版本。这些响应头都是非标准的，而且也不影响页面渲染，只是为了框架自身的宣传。</p>
<p>与 3.1 同理。如果你用的 Web 框架的当前版本爆出漏洞新闻，那么这些响应头信息会让你成为攻击者的靶子。</p>
<p><strong>建议</strong></p>
<ul>
<li>删除这些响应头：<code>X-Powered-By</code>, <code>X-Runtime</code>, <code>X-Version</code>, <code>X-AspNet-Version</code> 等。</li>
</ul>
<p><strong>部署情况占比（Alexa Top 500 站点中）</strong></p>
<ul>
<li>消除 Web 框架信息：85.7% 例：baidu.com github.com zhihu.com</li>
<li>未消除 Web 框架信息：14.3%</li>
</ul>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a href="http://www.troyhunt.com/2012/02/shhh-dont-let-your-response-headers.html" target="_blank" rel="external">Shhh… don’t let your response headers talk too loudly</a></li>
</ul>
<h1 id="4-Cookies"><a href="#4-Cookies" class="headerlink" title="4. Cookies"></a>4. Cookies</h1><h2 id="4-1-Cookie-安全"><a href="#4-1-Cookie-安全" class="headerlink" title="4.1 Cookie 安全"></a>4.1 Cookie 安全</h2><p>Cookies 中往往包含着敏感信息，比如 session ID。这些敏感 Cookie 需要添加 <code>secure</code> 字段，使其仅在 HTTPS 连接中被传递，在 HTTP 连接中不被传递。我们建议同时使用 HSTS 和 secure cookie。</p>
<p>session cookie 也应该被标记 <code>httponly</code> 字段，防止其被 javascript 访问。这可以阻止 XSS 攻击者窃取 session cookie。不敏感的 cookie 可以不加这个字段。但是呢，除非有明显的 javascrpit 操作需求，我们建议给所有的 cookie 都加入 <code>httponly</code> 字段。</p>
<p><strong>建议</strong></p>
<ul>
<li>尽可能把所有 cookie 都加上 ‘secure’ 和 ‘httponly’ 字段。<br>例：<code>Set-Cookie: Key=Value; path=/; secure; HttpOnly, Key2=Value2; secure; HttpOnly</code></li>
</ul>
<p><strong>兼容性</strong></p>
<ul>
<li>所有主流浏览器均支持。</li>
</ul>
<p><strong>部署情况占比（Alexa Top 500 站点中）</strong></p>
<ul>
<li>全 cookie secure: 8.6%</li>
<li>非全 cookie secure：91.4%</li>
</ul>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies" target="_blank" rel="external">HTTP cookies | MDN</a></li>
</ul>
<h1 id="5-结语"><a href="#5-结语" class="headerlink" title="5. 结语"></a>5. 结语</h1><p>本文原文来自<a href="https://httpsecurityreport.com/best_practice.html" target="_blank" rel="external">《HTTP Security Best Practice》</a>，我在译的时候同时加入了一些自己搜集整理的资料。</p>
<p>本文中对 Alexa Top 500 网站的数据统计来源自：<a href="https://httpsecurityreport.com/site_survey.html" target="_blank" rel="external">Alexa Top 500 Survey</a>，<br>撰写时数据统计至 2017 年 5 月 9 日。</p>
<p>可以看到，文中列出的措施部分较为严厉，为了安全有可能对可访问性造成损失。实际要部署哪些规则，需要根据网站实际情况选择。</p>
<p>最后附一张本站的 http security report。本站已经提交到 HSTS preload list 中，但是还没审核通过，所以有个小红叉。个人站就是用来折腾的，能上的策略基本都上了。</p>
<p><img src="/imgs/blog/httpsecurityreport.png" alt="HTTP Security Report"></p>
<p>再看一眼业界标杆<a href="https://imququ.com" target="_blank" rel="external">屈老师博客</a>的评分：</p>
<p><img src="/imgs/blog/httpsecurityreport2.png" alt="HTTP Security Report2"></p>
<p>不服不行。</p>
<h1 id="6-参考"><a href="#6-参考" class="headerlink" title="6. 参考"></a>6. 参考</h1><ol>
<li><a href="https://httpsecurityreport.com/" target="_blank" rel="external">HTTP Security Report</a></li>
<li><a href="https://labs.detectify.com/2016/07/05/what-hpkp-is-but-isnt/" target="_blank" rel="external">What HPKP is but isn’t</a></li>
<li><a href="https://imququ.com/post/http-public-key-pinning.html" target="_blank" rel="external">HTTP Public Key Pinning 介绍</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Security/MixedContent" target="_blank" rel="external">Mixed Content - Mozilla Developer Network</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Security/CSP" target="_blank" rel="external">CSP at Mozilla Developer Network</a></li>
<li><a href="http://weibo.com/2451315930/ECckdnjFl?from=page_1005052451315930_profile&amp;wvr=6&amp;mod=weibotime&amp;type=comment" target="_blank" rel="external">知乎曾出现过的 XSS 问题，因为部署了 CSP 没有收到影响</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/X-Frame-Options" target="_blank" rel="external">X-Frame-Options at Mozilla Developer Network</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection" target="_blank" rel="external">X-XSS-Protection</a></li>
<li><a href="https://httpsecurityreport.com/best_practice.html" target="_blank" rel="external">HTTP Caching Guide from Google Developers</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options" target="_blank" rel="external">X-Content-Type-Options</a></li>
<li><a href="https://imququ.com/post/subresource-integrity.html" target="_blank" rel="external">Subresource Integrity 介绍</a></li>
<li><a href="http://www.html5rocks.com/en/tutorials/security/sandboxed-iframes/" target="_blank" rel="external">HTML5 Rocks - Play safely in sandboxed IFrames</a></li>
<li><a href="http://www.ntp.org/ntpfaq/NTP-s-def.htm" target="_blank" rel="external">What is NTP?</a></li>
<li><a href="http://www.acunetix.com/blog/articles/configure-web-server-disclose-identity/" target="_blank" rel="external">How to configure your web server to not disclose it’s identity</a></li>
<li><a href="http://www.troyhunt.com/2012/02/shhh-dont-let-your-response-headers.html" target="_blank" rel="external">Shhh… don’t let your response headers talk too loudly</a></li>
<li><a href="https://www.owasp.org/index.php/Session_Management_Cheat_Sheet#Cookies" target="_blank" rel="external">OWASP Session Management Cheat Sheet - Cookies</a></li>
</ol>

            
                

            
        </div>
    </div>
    <div class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/http/" rel="tag">http</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/https/" rel="tag">https</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/nginx/" rel="tag">nginx</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/security/" rel="tag">security</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/05/24/practice-strict-code-style-check/"  data-tooltip="实践严格的代码风格检查来保证代码质量">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/05/08/get-aplus-score-in-ssllabs-with-nginx-and-letsencrypt/" data-tooltip="Nginx + Let&#39;s Encrypt 协力快速配置出 ssllabs A+ 评分的站点">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://www.404forest.com/2017/05/09/http-security-best-practice/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://www.404forest.com/2017/05/09/http-security-best-practice/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://www.404forest.com/2017/05/09/http-security-best-practice/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
            <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Jin. All Rights Reserved.
    </span>
    <a class="copyrights" target="_blank" rel="noopener" href="http://www.beian.miit.gov.cn/">
        浙ICP备18012561号
    </a>
</footer>

            </div>
        </div>
        <div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/ava.png"/>
        
            <h4 id="about-card-name">Jin</h4>
        
            <h5 id="about-card-bio">Interested in Web Development/Typography/Japanese.</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                WebDeveloper
            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Beijing
            </h5>
        
    </div>
</div>

        <div id="cover" style="background-image:url('/assets/images/bg4.jpg');"></div>
    </body>
    <!--SCRIPTS-->

<script src="/assets/js/script.min.js"></script>

<!--SCRIPTS END-->

    <script type="text/javascript">
        var disqus_shortname = '404forest';
        (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>


    <script type="text/javascript">
        (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
                (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
            e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
        })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

        _st('install','ZkJM8hxyxxLens-VGG__','2.0.0');
    </script>


</html>
